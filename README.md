## 🧾 영수증 OCR 관리 시스템 개발 현황 보고

### 1. 프로젝트 개요

PaddleOCR 기반의 멀티 프로세싱 기술을 활용하여 대량의 영수증 이미지를 분석하고, 사업자 번호, 가맹점명, 결제 금액 등을 추출하여 국세청 과세유형까지 자동으로 분류하는 웹 관리 시스템입니다.

---

### 2. 주요 요구사항 및 해결 방안

| 구분 | 요구사항 | 해결 방안 (구현 내용) |
| --- | --- | --- |
| **성능** | 수십 장의 영수증을 빠르게 처리해야 함 | **멀티 프로세싱(`ProcessPoolExecutor`)** 적용으로 CPU 코어 병렬 활용 |
| **보안/격리** | 사용자 간 데이터가 섞이거나 노출되면 안 됨 | 유저 **IP별 고유 디렉토리 격리** 시스템 구축 |
| **사용성** | 실시간 처리 현황을 눈으로 보고 싶음 | **NDJSON 스트리밍 전송**을 통해 작업 완료 건별 실시간 UI 반영 |
| **정확도** | 국세청 조회 실패 시 대처 수단 필요 | 실패 건에 대한 **개별 재조회 버튼** 및 **인터넷 연결 체크** 로직 구현 |
| **편의성** | 분석 결과를 엑셀로 저장하고 싶음 | BOM 처리가 완료된 **CSV 다운로드** 및 이미지 일괄 ZIP 다운로드 제공 |

---

### 3. 세부 개발 항목 (Technical Stack)

#### **[Backend] FastAPI & Python**

* **다중 사용자 격리:** `request.client.host`를 식별자로 사용하여 `storage/upload/{IP}`, `storage/result/{IP}` 하위 폴더에서만 작업 수행.
* **실시간 스트리밍 API:** `asyncio.as_completed`를 사용하여 먼저 끝난 작업부터 `StreamingResponse`로 클라이언트에 즉시 전송.
* **자동 데이터 클리닝:** 페이지 최초 접속(`GET /`) 및 분석 시작 버튼 클릭 시 이전 작업 데이터(임시 파일 등) 자동 삭제.
* **과세유형 재조회:** 특정 사업자 번호로 국세청 API를 다시 호출하는 전용 엔드포인트 마련.

#### **[Frontend] Vanilla JS & Bootstrap**

* **실시간 대시보드:** `Fetch API`의 `ReadableStream`을 사용하여 서버에서 오는 데이터를 한 줄씩 읽어 테이블에 실시간 렌더링.
* **진행률 표시:** `처리 중 (N/M)` 형태의 텍스트 피드백으로 전체 작업 대비 진행률 노출.
* **스마트 버튼:** 분석 중 버튼 비활성화, 국세청 조회 실패 시에만 '재조회' 버튼 노출.
* **네트워크 상태 감지:** 브라우저의 `navigator.onLine`을 활용하여 네트워크 단절 시 사용자에게 알림.

#### **[Worker] PaddleOCR & Image Processing**

* **멀티 프로세싱 워커:** 개별 프로세스 내에서 OCR 엔진을 초기화하여 직렬화(Serialization) 에러 방지 및 속도 극대화.
* **시각화:** OCR 결과(BBox)가 그려진 이미지와 정리된 원본 이미지를 각각 생성.

---

### 4. 현재 워크플로우 (Summary)

1. **접속:** 사용자가 접속하면 IP를 식별하고 기존 쓰레기 파일 정리.
2. **업로드:** 드래그 앤 드롭으로 다수의 파일 업로드.
3. **시작:** 버튼 클릭 즉시 테이블 초기화 및 서버 병렬 연산 시작.
4. **피드백:** 작업이 완료되는 순서대로 화면에 데이터가 하나씩 탁-탁-탁 나타나며 진행률 갱신.
5. **사후처리:** 실패한 과세 유형은 '재조회' 버튼으로 개별 처리 후, 전체 결과를 CSV나 ZIP으로 획득.

---

## ToDo

1. 과세조회 실패 시 재조회 기능 검증 필요